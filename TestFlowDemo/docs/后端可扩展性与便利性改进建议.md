# 后端可扩展性与便利性改进建议（面向通用测试框架）

目标：面向长期演进，降低“新增设备/新增产品/维护”的成本，同时保持“小而美”的单体交付形态。

## 一、设备与传输（现状与建议）
- 已完成：设备注册表 `DeviceFactory.Register(type, factory)`；插件化加载（`Plugins/*.dll`，`IDeviceRegistrar`/`[DeviceType]`）。
- 已完成：串口/ CAN 传输封装；串口在非 Windows 自动仿真，支持 `SIM:` 前缀。
- 建议增强：补齐 Modbus/TCP/UDP 重试与统一超时/日志策略（当前已提供最小 TCP/UDP 实现）。

## 二、流程与配置
- 已完成：流程预校验（`DependsOn/分支/子流程引用/设备映射`）。
- 待改进：检测“死链/孤岛”；提供 JSON Schema（`devices.json/infrastructure.json/flows/*.json/subflows/*.json`）与 CLI 校验；新增 `flow init <Model>` 脚手架。

## 三、参数与数据
- 已完成：DB 注入 + TTL；建表由 `Entities.sql` 统一管理（幂等执行）。
- 建议增强：按工位覆盖/按批次锁定；CLI 提供 `db migrate/seed` 命令。

## 四、可观测与排障
- 建议增强：统一步骤日志格式（含耗时与关键参数）；失败三要素（实际/期望/误差/上下文）写入 DB。

## 五、测试与 CI
- 已具备：CLI 可在 macOS 上完整跑流程（串口仿真+CAN 回显）。
- 建议增强：提供确定性 Fake 设备；CLI 增加 `--simulate` 全局开关；最小 E2E 用例纳入 CI。

## 六、演进与兼容
- 建议：`flows/subflows` 版本化与兼容策略；插件加载现已支持，后续可补签名校验与来源白名单。

> 上述建议遵循“小步快跑，可回退”原则，优先落地脚手架、JSON Schema、仿真与 CLI 校验/运行，直接提升日常开发效率与接入速度。
